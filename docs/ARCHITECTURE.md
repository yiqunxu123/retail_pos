# KHUB Retail POS æž¶æž„æ–‡æ¡£

## ðŸ“ ç³»ç»Ÿæž¶æž„æ¦‚è§ˆ

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº† KHUB Retail POS ç³»ç»Ÿçš„å®Œæ•´æž¶æž„ï¼ŒåŒ…æ‹¬ Web åº”ç”¨å’Œ React Native APP çš„æŠ€æœ¯å®žçŽ°ã€‚

---

## ç›®å½•

1. [æ•´ä½“æž¶æž„](#æ•´ä½“æž¶æž„)
2. [æ•°æ®åŒæ­¥æž¶æž„](#æ•°æ®åŒæ­¥æž¶æž„)
3. [æŠ€æœ¯æ ˆè¯¦è§£](#æŠ€æœ¯æ ˆè¯¦è§£)
4. [æ¨¡å—æž¶æž„](#æ¨¡å—æž¶æž„)
5. [æ•°æ®æµå›¾](#æ•°æ®æµå›¾)
6. [å®‰å…¨æž¶æž„](#å®‰å…¨æž¶æž„)

---

## æ•´ä½“æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Client Layer (å®¢æˆ·ç«¯å±‚)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Web Application         â”‚    React Native Mobile APP             â”‚
â”‚    (React + Redux)         â”‚    (Expo + PowerSync)                  â”‚
â”‚                            â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ UI Components        â”‚  â”‚  â”‚ React Native Components          â”‚ â”‚
â”‚  â”‚ - Bootstrap          â”‚  â”‚  â”‚ - Native UI                      â”‚ â”‚
â”‚  â”‚ - Material-UI        â”‚  â”‚  â”‚ - NativeWind (Tailwind)          â”‚ â”‚
â”‚  â”‚ - Ant Design         â”‚  â”‚  â”‚                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚              â”‚             â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Redux Store          â”‚  â”‚  â”‚ React Hooks + Context            â”‚ â”‚
â”‚  â”‚ - Redux Saga         â”‚  â”‚  â”‚ - AuthContext                    â”‚ â”‚
â”‚  â”‚ - Redux Toolkit      â”‚  â”‚  â”‚ - OrderContext                   â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚  â”‚ - ClockContext                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚              â”‚             â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Axios HTTP Client    â”‚  â”‚  â”‚ PowerSync + Axios                â”‚ â”‚
â”‚  â”‚ - REST API Calls     â”‚  â”‚  â”‚ - Local SQLite DB                â”‚ â”‚
â”‚  â”‚ - JWT Auth           â”‚  â”‚  â”‚ - Real-time Sync Engine          â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚  â”‚ - Offline Queue                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                            â”‚
              â”‚ HTTPS REST API             â”‚ HTTPS + WebSocket
              â”‚                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Backend Layer (åŽç«¯å±‚)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    KHUB Backend API        â”‚    PowerSync Self-Hosted Server       â”‚
â”‚    (Flask + Gunicorn)      â”‚    (Docker Container)                 â”‚
â”‚                            â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ REST API Endpoints   â”‚  â”‚  â”‚ WebSocket Server                 â”‚ â”‚
â”‚  â”‚ /tenant/api/v1/*     â”‚  â”‚  â”‚ - Real-time Sync                 â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚  â”‚ - Incremental Updates            â”‚ â”‚
â”‚  â”‚ - Catalog            â”‚  â”‚  â”‚ - JWT Authentication             â”‚ â”‚
â”‚  â”‚ - Inventory          â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚ - Sale               â”‚  â”‚           â”‚                           â”‚
â”‚  â”‚ - Accounting         â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ - Report             â”‚  â”‚  â”‚ PostgreSQL WAL Reader            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ - Logical Replication            â”‚ â”‚
â”‚             â”‚              â”‚  â”‚ - Change Data Capture            â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚ Business Logic       â”‚  â”‚           â”‚                           â”‚
â”‚  â”‚ - SQLAlchemy ORM     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ - Validation         â”‚  â”‚  â”‚ MongoDB (Sync Buckets)           â”‚ â”‚
â”‚  â”‚ - Authorization      â”‚  â”‚  â”‚ - Temporary Storage              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚              â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                        â”‚
â”‚  â”‚ Background Jobs      â”‚  â”‚                                        â”‚
â”‚  â”‚ - Celery             â”‚  â”‚                                        â”‚
â”‚  â”‚ - Redis Queue        â”‚  â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ SQL Queries
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Layer (æ•°æ®å±‚)                               â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              PostgreSQL Database (Primary)                      â”‚ â”‚
â”‚  â”‚              - Multi-tenant Architecture                        â”‚ â”‚
â”‚  â”‚              - Logical Replication Enabled                      â”‚ â”‚
â”‚  â”‚              - Write-Ahead Logging (WAL)                        â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚  â”‚ Admin DB    â”‚  â”‚ Tenant DBs   â”‚  â”‚ Replication Slot â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ - Tenants   â”‚  â”‚ - Products   â”‚  â”‚ - powersync      â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ - Users     â”‚  â”‚ - Customers  â”‚  â”‚                  â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ - Settings  â”‚  â”‚ - Orders     â”‚  â”‚                  â”‚      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Redis (Cache & Queue)                              â”‚ â”‚
â”‚  â”‚              - Session Cache                                    â”‚ â”‚
â”‚  â”‚              - Celery Task Queue                                â”‚ â”‚
â”‚  â”‚              - Rate Limiting                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®åŒæ­¥æž¶æž„

### PowerSync åŒæ­¥æœºåˆ¶è¯¦è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PostgreSQL (Source of Truth)                    â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  products    â”‚  â”‚  customers   â”‚  â”‚ sale_orders  â”‚           â”‚
â”‚  â”‚  - id        â”‚  â”‚  - id        â”‚  â”‚  - id        â”‚           â”‚
â”‚  â”‚  - name      â”‚  â”‚  - name      â”‚  â”‚  - total     â”‚           â”‚
â”‚  â”‚  - price     â”‚  â”‚  - balance   â”‚  â”‚  - status    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                 â”‚                 â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                           â”‚                                       â”‚
â”‚                  Write-Ahead Log (WAL)                            â”‚
â”‚                  Logical Replication                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Stream Changes
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PowerSync Server (Port 8080)                    â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ WAL Stream Processor                                        â”‚  â”‚
â”‚  â”‚ - Captures INSERT/UPDATE/DELETE from PostgreSQL            â”‚  â”‚
â”‚  â”‚ - Converts to PowerSync format                             â”‚  â”‚
â”‚  â”‚ - Groups changes into "buckets" by table/user              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                      â”‚
â”‚                            â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Sync Rules Engine (sync_rules.yaml)                        â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ streams:                                                    â”‚  â”‚
â”‚  â”‚   products:                                                 â”‚  â”‚
â”‚  â”‚     query: "SELECT id, name, price FROM products"          â”‚  â”‚
â”‚  â”‚   customers:                                                â”‚  â”‚
â”‚  â”‚     query: "SELECT id, name, balance FROM customers"       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                      â”‚
â”‚                            â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ MongoDB (Sync Buckets Storage)                             â”‚  â”‚
â”‚  â”‚ - Temporary storage for incremental changes                â”‚  â”‚
â”‚  â”‚ - Bucket per user per table                                â”‚  â”‚
â”‚  â”‚ - Checkpoints for sync state                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                      â”‚
â”‚                            â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ WebSocket Server                                            â”‚  â”‚
â”‚  â”‚ - Maintains connection with each mobile client             â”‚  â”‚
â”‚  â”‚ - Pushes incremental updates in real-time                  â”‚  â”‚
â”‚  â”‚ - JWT authentication per connection                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ WebSocket (ws://host:8080)
                            â”‚ JWT Token: Bearer xxx
                            â”‚ Incremental Sync Packets
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              React Native APP (Multiple Devices)                  â”‚
â”‚                                                                    â”‚
â”‚  Device 1 (POS 1)        Device 2 (POS 2)        Device 3 (Web)  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PowerSync Clientâ”‚    â”‚ PowerSync Clientâ”‚    â”‚ N/A         â”‚  â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚             â”‚  â”‚
â”‚  â”‚ SQLite DB       â”‚    â”‚ SQLite DB       â”‚    â”‚ REST API    â”‚  â”‚
â”‚  â”‚ â”œâ”€ products     â”‚    â”‚ â”œâ”€ products     â”‚    â”‚ (Direct)    â”‚  â”‚
â”‚  â”‚ â”œâ”€ customers    â”‚    â”‚ â”œâ”€ customers    â”‚    â”‚             â”‚  â”‚
â”‚  â”‚ â””â”€ sale_orders  â”‚    â”‚ â””â”€ sale_orders  â”‚    â”‚             â”‚  â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚             â”‚  â”‚
â”‚  â”‚ CRUD Queue      â”‚    â”‚ CRUD Queue      â”‚    â”‚             â”‚  â”‚
â”‚  â”‚ â”œâ”€ PUT ops      â”‚    â”‚ â”œâ”€ PUT ops      â”‚    â”‚             â”‚  â”‚
â”‚  â”‚ â”œâ”€ PATCH ops    â”‚    â”‚ â”œâ”€ PATCH ops    â”‚    â”‚             â”‚  â”‚
â”‚  â”‚ â””â”€ DELETE ops   â”‚    â”‚ â””â”€ DELETE ops   â”‚    â”‚             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                      â”‚                               â”‚
â”‚           â”‚ Upload Queue         â”‚ Upload Queue                  â”‚
â”‚           â”‚ (when online)        â”‚ (when online)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                      â”‚
            â”‚ HTTPS REST API       â”‚ HTTPS REST API
            â”‚ PUT/PATCH/DELETE     â”‚ PUT/PATCH/DELETE
            â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    KHUB Backend API                               â”‚
â”‚              /tenant/api/v1/catalog/products/:id                  â”‚
â”‚              /tenant/api/v1/sale/customers/:id                    â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ KhubConnector.uploadData()                                  â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ for each operation in queue:                               â”‚  â”‚
â”‚  â”‚   switch (op.type):                                        â”‚  â”‚
â”‚  â”‚     case PUT:    await api.put(endpoint, data)             â”‚  â”‚
â”‚  â”‚     case PATCH:  await api.patch(endpoint, data)           â”‚  â”‚
â”‚  â”‚     case DELETE: await api.delete(endpoint)                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                      â”‚
â”‚                            â–¼                                      â”‚
â”‚                     Write to PostgreSQL                           â”‚
â”‚                            â”‚                                      â”‚
â”‚                            â–¼                                      â”‚
â”‚                    Trigger WAL Event                              â”‚
â”‚                            â”‚                                      â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                                           â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â””â”€â”€â–º Back to PowerSync
                                                 (Circular sync)
```

### åŒæ­¥æµç¨‹æ—¶åºå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ APP  â”‚        â”‚PowerSyncâ”‚       â”‚  Backend  â”‚       â”‚PostgreSQLâ”‚
â””â”€â”€â”¬â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚                 â”‚                â”‚                   â”‚
   â”‚ 1. åˆå§‹è¿žæŽ¥      â”‚                â”‚                   â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                   â”‚
   â”‚   WebSocket     â”‚                â”‚                   â”‚
   â”‚   + JWT Token   â”‚                â”‚                   â”‚
   â”‚                 â”‚                â”‚                   â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                   â”‚
   â”‚ 2. Connection OKâ”‚                â”‚                   â”‚
   â”‚                 â”‚                â”‚                   â”‚
   â”‚ 3. Query Local  â”‚                â”‚                   â”‚
   â”‚    SELECT *     â”‚                â”‚                   â”‚
   â”‚<â”€â”€â”€â”            â”‚                â”‚                   â”‚
   â”‚    â”‚ SQLite     â”‚                â”‚                   â”‚
   â”‚<â”€â”€â”€â”˜            â”‚                â”‚                   â”‚
   â”‚                 â”‚                â”‚                   â”‚
   â”‚ 4. Display Data â”‚                â”‚                   â”‚
   â”‚ (Instant!)      â”‚                â”‚                   â”‚
   â”‚                 â”‚                â”‚                   â”‚
   â”‚ 5. User Edit    â”‚                â”‚                   â”‚
   â”‚    (Offline OK) â”‚                â”‚                   â”‚
   â”œâ”€â”€â”€â”             â”‚                â”‚                   â”‚
   â”‚   â”‚ Write Local â”‚                â”‚                   â”‚
   â”‚   â”‚ SQLite      â”‚                â”‚                   â”‚
   â”‚<â”€â”€â”˜             â”‚                â”‚                   â”‚
   â”‚                 â”‚                â”‚                   â”‚
   â”‚ 6. Queue Upload â”‚                â”‚                   â”‚
   â”‚    Operation    â”‚                â”‚                   â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                   â”‚
   â”‚   CRUD Entry    â”‚                â”‚                   â”‚
   â”‚                 â”‚                â”‚                   â”‚
   â”‚                 â”‚ 7. Upload to   â”‚                   â”‚
   â”‚                 â”‚    Backend     â”‚                   â”‚
   â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
   â”‚                 â”‚  PUT /api/v1/  â”‚                   â”‚
   â”‚                 â”‚  products/:id  â”‚                   â”‚
   â”‚                 â”‚                â”‚                   â”‚
   â”‚                 â”‚                â”‚ 8. Write to DB    â”‚
   â”‚                 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                â”‚   UPDATE products â”‚
   â”‚                 â”‚                â”‚                   â”‚
   â”‚                 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                â”‚ 9. WAL Event      â”‚
   â”‚                 â”‚                â”‚                   â”‚
   â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
   â”‚                 â”‚ 10. Sync Done  â”‚                   â”‚
   â”‚                 â”‚                â”‚                   â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 11. Push Updateâ”‚                   â”‚
   â”‚  WebSocket Push â”‚    to all      â”‚                   â”‚
   â”‚  (Real-time!)   â”‚    clients     â”‚                   â”‚
   â”‚                 â”‚                â”‚                   â”‚
   â”‚ 12. Merge Local â”‚                â”‚                   â”‚
   â”‚     Changes     â”‚                â”‚                   â”‚
   â”œâ”€â”€â”€â”             â”‚                â”‚                   â”‚
   â”‚   â”‚ Update      â”‚                â”‚                   â”‚
   â”‚   â”‚ SQLite      â”‚                â”‚                   â”‚
   â”‚<â”€â”€â”˜             â”‚                â”‚                   â”‚
   â”‚                 â”‚                â”‚                   â”‚
   â”‚ 13. UI Auto     â”‚                â”‚                   â”‚
   â”‚     Refresh     â”‚                â”‚                   â”‚
   â”‚                 â”‚                â”‚                   â”‚
```

---

## æŠ€æœ¯æ ˆè¯¦è§£

### Backend Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend Technology Stack                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Runtime & Framework:                                        â”‚
â”‚  â”œâ”€ Python 3.9+                                              â”‚
â”‚  â”œâ”€ Flask 2.1.2 (Web Framework)                              â”‚
â”‚  â”œâ”€ Gunicorn 21.2.0 (WSGI Server)                            â”‚
â”‚  â””â”€ Gevent (Async Worker)                                    â”‚
â”‚                                                               â”‚
â”‚  Database:                                                    â”‚
â”‚  â”œâ”€ PostgreSQL 14+ (Primary Database)                        â”‚
â”‚  â”‚  â”œâ”€ Logical Replication Enabled                           â”‚
â”‚  â”‚  â”œâ”€ Multi-tenant Schema (per-tenant DB)                   â”‚
â”‚  â”‚  â””â”€ WAL Level = logical                                   â”‚
â”‚  â”œâ”€ SQLAlchemy 2.0.20 (ORM)                                  â”‚
â”‚  â”œâ”€ Alembic 1.12.0 (Migrations)                              â”‚
â”‚  â””â”€ psycopg2-binary 2.9.7 (Driver)                           â”‚
â”‚                                                               â”‚
â”‚  Caching & Queue:                                             â”‚
â”‚  â”œâ”€ Redis 4.6.0                                              â”‚
â”‚  â”‚  â”œâ”€ Session Storage                                       â”‚
â”‚  â”‚  â”œâ”€ Task Queue (Celery)                                   â”‚
â”‚  â”‚  â””â”€ Rate Limiting                                         â”‚
â”‚  â””â”€ Celery 5.2.7 (Background Jobs)                           â”‚
â”‚                                                               â”‚
â”‚  Authentication:                                              â”‚
â”‚  â”œâ”€ Flask-JWT-Extended 4.5.2                                 â”‚
â”‚  â”‚  â”œâ”€ Access Token (1 day)                                  â”‚
â”‚  â”‚  â”œâ”€ Refresh Token (30 days)                               â”‚
â”‚  â”‚  â””â”€ Audience: ["powersync"] for APP                       â”‚
â”‚  â””â”€ Flask-PyOTP (2FA)                                        â”‚
â”‚                                                               â”‚
â”‚  API:                                                         â”‚
â”‚  â”œâ”€ Flask-RESTX 0.5.1 (OpenAPI/Swagger)                      â”‚
â”‚  â””â”€ Flask-Cors 4.0.0                                         â”‚
â”‚                                                               â”‚
â”‚  Storage:                                                     â”‚
â”‚  â”œâ”€ AWS S3 (boto3 1.28.49)                                   â”‚
â”‚  â”‚  â””â”€ Bucket: khub-app                                      â”‚
â”‚  â””â”€ MinIO (Local development)                                â”‚
â”‚                                                               â”‚
â”‚  Integrations:                                                â”‚
â”‚  â”œâ”€ OpenAI 1.88.0 (AI Features)                              â”‚
â”‚  â”œâ”€ Stripe 4.2.0 (Payments)                                  â”‚
â”‚  â”œâ”€ Plaid (Bank Connections)                                 â”‚
â”‚  â””â”€ Azure Form Recognizer (OCR)                              â”‚
â”‚                                                               â”‚
â”‚  Monitoring:                                                  â”‚
â”‚  â”œâ”€ Prometheus Client                                        â”‚
â”‚  â””â”€ Custom Logging                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Web Frontend Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Web Frontend Technology Stack                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Framework:                                                   â”‚
â”‚  â”œâ”€ React 17.0.1                                             â”‚
â”‚  â”œâ”€ React Scripts 4.0.3 (CRA)                                â”‚
â”‚  â””â”€ React Router DOM 5.2.0                                   â”‚
â”‚                                                               â”‚
â”‚  State Management:                                            â”‚
â”‚  â”œâ”€ Redux 4.0.5                                              â”‚
â”‚  â”œâ”€ @reduxjs/toolkit 1.5.0                                   â”‚
â”‚  â”œâ”€ Redux Saga 1.1.3 (Side Effects)                          â”‚
â”‚  â”œâ”€ Redux Persist 6.0.0                                      â”‚
â”‚  â””â”€ React Redux 7.2.2                                        â”‚
â”‚                                                               â”‚
â”‚  UI Libraries:                                                â”‚
â”‚  â”œâ”€ Bootstrap 4.5.3                                          â”‚
â”‚  â”œâ”€ React Bootstrap 1.4.1                                    â”‚
â”‚  â”œâ”€ Material-UI 4.12.4                                       â”‚
â”‚  â”‚  â”œâ”€ @material-ui/core                                     â”‚
â”‚  â”‚  â”œâ”€ @material-ui/icons                                    â”‚
â”‚  â”‚  â””â”€ @material-ui/pickers                                  â”‚
â”‚  â””â”€ Ant Design 4.9.4                                         â”‚
â”‚                                                               â”‚
â”‚  Data Tables:                                                 â”‚
â”‚  â”œâ”€ AG-Grid 29.3.4                                           â”‚
â”‚  â”œâ”€ React Bootstrap Table                                    â”‚
â”‚  â””â”€ React Virtuoso (Virtual Scrolling)                       â”‚
â”‚                                                               â”‚
â”‚  Forms:                                                       â”‚
â”‚  â”œâ”€ Formik 2.2.6                                             â”‚
â”‚  â”œâ”€ Yup 0.32.8 (Validation)                                  â”‚
â”‚  â””â”€ Formik-Antd 2.0.1                                        â”‚
â”‚                                                               â”‚
â”‚  HTTP Client:                                                 â”‚
â”‚  â”œâ”€ Axios 0.21.0                                             â”‚
â”‚  â””â”€ Axios Mock Adapter                                       â”‚
â”‚                                                               â”‚
â”‚  Data Visualization:                                          â”‚
â”‚  â”œâ”€ ApexCharts 3.22.3                                        â”‚
â”‚  â””â”€ React Charts                                             â”‚
â”‚                                                               â”‚
â”‚  Utilities:                                                   â”‚
â”‚  â”œâ”€ Lodash 4.17.20                                           â”‚
â”‚  â”œâ”€ Moment.js                                                â”‚
â”‚  â”œâ”€ Date-fns 2.16.1                                          â”‚
â”‚  â””â”€ Numeral 2.0.6                                            â”‚
â”‚                                                               â”‚
â”‚  Dev Tools:                                                   â”‚
â”‚  â”œâ”€ ESLint                                                   â”‚
â”‚  â”œâ”€ Prettier                                                 â”‚
â”‚  â””â”€ React Query DevTools                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### React Native APP Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              React Native APP Technology Stack                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Framework:                                                   â”‚
â”‚  â”œâ”€ React 19.1.0                                             â”‚
â”‚  â”œâ”€ React Native 0.81.5                                      â”‚
â”‚  â”œâ”€ Expo SDK ~54.0.31                                        â”‚
â”‚  â””â”€ Expo Router ~6.0.22 (File-based Routing)                 â”‚
â”‚                                                               â”‚
â”‚  Local Database:                                              â”‚
â”‚  â”œâ”€ @powersync/react-native 1.28.1                           â”‚
â”‚  â”‚  â”œâ”€ SQLite (Local Storage)                                â”‚
â”‚  â”‚  â”œâ”€ Real-time Sync Engine                                 â”‚
â”‚  â”‚  â””â”€ Offline Queue                                         â”‚
â”‚  â””â”€ @journeyapps/react-native-quick-sqlite 2.5.0             â”‚
â”‚                                                               â”‚
â”‚  State Management:                                            â”‚
â”‚  â”œâ”€ React Hooks (useState, useEffect, useMemo)               â”‚
â”‚  â”œâ”€ React Context API                                        â”‚
â”‚  â”‚  â”œâ”€ AuthContext (Authentication)                          â”‚
â”‚  â”‚  â”œâ”€ OrderContext (Cart Management)                        â”‚
â”‚  â”‚  â”œâ”€ ClockContext (Time Tracking)                          â”‚
â”‚  â”‚  â””â”€ ParkedOrderContext (Draft Orders)                     â”‚
â”‚  â””â”€ Custom Hooks in utils/powersync/hooks/                   â”‚
â”‚                                                               â”‚
â”‚  UI & Styling:                                                â”‚
â”‚  â”œâ”€ NativeWind 4.2.1 (Tailwind for RN)                       â”‚
â”‚  â”œâ”€ Tailwind CSS 3.4.19                                      â”‚
â”‚  â”œâ”€ @expo/vector-icons (Ionicons)                            â”‚
â”‚  â””â”€ Custom Components in components/                         â”‚
â”‚                                                               â”‚
â”‚  Navigation:                                                  â”‚
â”‚  â”œâ”€ Expo Router (File-based)                                 â”‚
â”‚  â”œâ”€ @react-navigation/native 7.1.8                           â”‚
â”‚  â””â”€ @react-navigation/bottom-tabs 7.4.0                      â”‚
â”‚                                                               â”‚
â”‚  HTTP Client:                                                 â”‚
â”‚  â”œâ”€ Axios 1.13.3                                             â”‚
â”‚  â””â”€ Custom API wrapper in utils/api/                         â”‚
â”‚                                                               â”‚
â”‚  Storage:                                                     â”‚
â”‚  â”œâ”€ @react-native-async-storage/async-storage 2.2.0          â”‚
â”‚  â”‚  â”œâ”€ JWT Tokens                                            â”‚
â”‚  â”‚  â”œâ”€ User Info                                             â”‚
â”‚  â”‚  â””â”€ App Settings                                          â”‚
â”‚  â””â”€ PowerSync SQLite (Synced Data)                           â”‚
â”‚                                                               â”‚
â”‚  Hardware:                                                    â”‚
â”‚  â”œâ”€ expo-haptics (Vibration Feedback)                        â”‚
â”‚  â”œâ”€ react-native-thermal-receipt-printer 1.2.0               â”‚
â”‚  â”‚  â”œâ”€ Ethernet Printers                                     â”‚
â”‚  â”‚  â”œâ”€ USB Printers                                          â”‚
â”‚  â”‚  â””â”€ Bluetooth Printers                                    â”‚
â”‚  â””â”€ Custom PrintQueue Manager                                â”‚
â”‚                                                               â”‚
â”‚  Utilities:                                                   â”‚
â”‚  â”œâ”€ TypeScript 5.9.2                                         â”‚
â”‚  â”œâ”€ expo-constants (Environment)                             â”‚
â”‚  â””â”€ expo-linking (Deep Links)                                â”‚
â”‚                                                               â”‚
â”‚  Dev Tools:                                                   â”‚
â”‚  â”œâ”€ ESLint                                                   â”‚
â”‚  â”œâ”€ Jest 30.2.0 (Testing)                                    â”‚
â”‚  â””â”€ ts-jest 29.4.6                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PowerSync Infrastructure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               PowerSync Infrastructure Stack                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  PowerSync Server:                                            â”‚
â”‚  â”œâ”€ Docker Container (self-hosted)                           â”‚
â”‚  â”œâ”€ Port: 8080 (WebSocket + HTTP)                            â”‚
â”‚  â”œâ”€ Config: powersync/config.yaml                            â”‚
â”‚  â””â”€ Sync Rules: powersync/sync_rules.yaml                    â”‚
â”‚                                                               â”‚
â”‚  Source Database:                                             â”‚
â”‚  â”œâ”€ PostgreSQL Connection                                    â”‚
â”‚  â”‚  â”œâ”€ Host: PS_KHUB_DB_HOST                                 â”‚
â”‚  â”‚  â”œâ”€ Port: PS_KHUB_DB_PORT (5434)                          â”‚
â”‚  â”‚  â”œâ”€ Database: PS_KHUB_DB_NAME                             â”‚
â”‚  â”‚  â”œâ”€ User: PS_KHUB_DB_USER                                 â”‚
â”‚  â”‚  â””â”€ Password: PS_KHUB_DB_PASSWORD                         â”‚
â”‚  â”œâ”€ Replication Slot: powersync                              â”‚
â”‚  â””â”€ Publication: powersync (ALL TABLES)                      â”‚
â”‚                                                               â”‚
â”‚  Sync Storage:                                                â”‚
â”‚  â”œâ”€ MongoDB 7.0+                                             â”‚
â”‚  â”‚  â”œâ”€ Docker Container (mongo:7)                            â”‚
â”‚  â”‚  â”œâ”€ Port: 27017                                           â”‚
â”‚  â”‚  â”œâ”€ Replica Set: rs0                                      â”‚
â”‚  â”‚  â””â”€ Database: powersync                                   â”‚
â”‚  â””â”€ Purpose: Temporary storage for sync buckets              â”‚
â”‚                                                               â”‚
â”‚  Authentication:                                              â”‚
â”‚  â”œâ”€ JWT HS256                                                â”‚
â”‚  â”‚  â”œâ”€ Secret: PS_JWT_SECRET_BASE64 (base64 encoded)         â”‚
â”‚  â”‚  â”œâ”€ Audience: ["powersync"]                               â”‚
â”‚  â”‚  â””â”€ Token from KHUB Backend                               â”‚
â”‚  â””â”€ Per-connection authentication                            â”‚
â”‚                                                               â”‚
â”‚  Sync Configuration:                                          â”‚
â”‚  â”œâ”€ Edition: 2 (Streams mode)                                â”‚
â”‚  â”œâ”€ Auto Subscribe: true                                     â”‚
â”‚  â”œâ”€ 17 Tables synced:                                        â”‚
â”‚  â”‚  â”œâ”€ products, categories, brands                          â”‚
â”‚  â”‚  â”œâ”€ customers, customer_groups                            â”‚
â”‚  â”‚  â”œâ”€ stocks, unit_prices, channels                         â”‚
â”‚  â”‚  â”œâ”€ sale_orders, sale_order_details                       â”‚
â”‚  â”‚  â”œâ”€ payments, suppliers                                   â”‚
â”‚  â”‚  â”œâ”€ settings, tags, tenant_users                          â”‚
â”‚  â”‚  â””â”€ customer_groups_customer                              â”‚
â”‚  â””â”€ Real-time incremental updates                            â”‚
â”‚                                                               â”‚
â”‚  Network:                                                     â”‚
â”‚  â”œâ”€ Docker Network: powersync_network                        â”‚
â”‚  â”œâ”€ WebSocket: ws://localhost:8080                           â”‚
â”‚  â””â”€ HTTP API: http://localhost:8080                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¨¡å—æž¶æž„

### Backend Module Structure

```
kapp/server/
â”œâ”€â”€ app/                          # Flask Application
â”‚   â”œâ”€â”€ admin/                    # Admin API
â”‚   â”‚   â”œâ”€â”€ auth.py               # Admin authentication
â”‚   â”‚   â”œâ”€â”€ tenant.py             # Tenant management
â”‚   â”‚   â””â”€â”€ webhook_api/          # Webhook handlers
â”‚   â””â”€â”€ tenant/                   # Tenant API (177 files)
â”‚       â”œâ”€â”€ accounting_api/       # Accounting endpoints
â”‚       â”œâ”€â”€ catalog_api/          # Product catalog
â”‚       â”œâ”€â”€ core_api/             # Core utilities
â”‚       â”œâ”€â”€ inventory_api/        # Inventory management
â”‚       â”œâ”€â”€ marketing_api/        # Marketing & promotions
â”‚       â”œâ”€â”€ report_api/           # Reporting
â”‚       â””â”€â”€ sale_api/             # Sales & orders
â”‚
â”œâ”€â”€ models/                       # Database Models
â”‚   â”œâ”€â”€ admin/                    # Admin models
â”‚   â””â”€â”€ tenant/                   # Tenant models
â”‚       â”œâ”€â”€ accounting_models/    # Accounting tables
â”‚       â”œâ”€â”€ ai_models/            # AI-related tables
â”‚       â”œâ”€â”€ catalog_models/       # Product, Category, Brand
â”‚       â”‚   â”œâ”€â”€ product.py        # Product, UnitPrice
â”‚       â”‚   â”œâ”€â”€ catagory.py       # Category
â”‚       â”‚   â””â”€â”€ brand.py          # Brand
â”‚       â”œâ”€â”€ core_models/          # Core tables
â”‚       â”‚   â”œâ”€â”€ customer.py       # Customer model
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”œâ”€â”€ inventory_models/     # Inventory tables
â”‚       â”œâ”€â”€ sale_models/          # Sale tables
â”‚       â”‚   â”œâ”€â”€ sale_order.py     # SaleOrder
â”‚       â”‚   â”œâ”€â”€ cart.py           # Cart
â”‚       â”‚   â””â”€â”€ payment.py        # Payment
â”‚       â””â”€â”€ views/                # Database views
â”‚
â”œâ”€â”€ service/                      # Business Logic Services
â”œâ”€â”€ utils/                        # Utility Functions
â”œâ”€â”€ migrations/                   # Alembic Migrations
â””â”€â”€ constants/                    # Constants & Enums
```

### Web Frontend Module Structure

```
kapp/client/tenant/src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ modules/                  # Feature Modules
â”‚   â”‚   â”œâ”€â”€ Auth/                 # Authentication
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/            # Login, Register
â”‚   â”‚   â”‚   â””â”€â”€ _redux/           # Auth Redux
â”‚   â”‚   â”œâ”€â”€ Dashboard/            # Dashboard module
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/            # Dashboard pages
â”‚   â”‚   â”‚   â””â”€â”€ _redux/           # Dashboard Redux
â”‚   â”‚   â”œâ”€â”€ Catalog/              # Product Catalog
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ products/     # Product list
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ productss/    # Product add/edit
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ brands/       # Brand management
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ categories/   # Category management
â”‚   â”‚   â”‚   â””â”€â”€ _redux/
â”‚   â”‚   â”‚       â”œâ”€â”€ products/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ productsSlice.js
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ productsCrud.js
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ productsActions.js
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ productsSaga.js
â”‚   â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ Inventory/            # Inventory module
â”‚   â”‚   â”œâ”€â”€ Sale/                 # Sales module
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ customer/     # Customer management
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ order/        # Order management
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â””â”€â”€ _redux/
â”‚   â”‚   â”‚       â”œâ”€â”€ customers/
â”‚   â”‚   â”‚       â”œâ”€â”€ orders/
â”‚   â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ Report/               # Reporting
â”‚   â”‚   â”œâ”€â”€ Marketing/            # Marketing
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ Routes.js                 # High-level routes
â”‚   â””â”€â”€ BasePage.js               # Main routing
â”‚
â”œâ”€â”€ _metronic/                    # UI Template
â”‚   â”œâ”€â”€ layout/                   # Layout components
â”‚   â””â”€â”€ _partials/                # Shared components
â”‚
â””â”€â”€ constants/                    # Constants
    â””â”€â”€ config/                   # API endpoints
```

### React Native APP Module Structure

```
app/                              # Expo Router Pages
â”œâ”€â”€ _layout.tsx                   # Root layout
â”œâ”€â”€ index.tsx                     # Dashboard
â”œâ”€â”€ login.tsx                     # Login screen
â”œâ”€â”€ pos-line.tsx                  # POS Terminal
â”œâ”€â”€ settings.tsx                  # Settings
â”œâ”€â”€ test-sync.tsx                 # Sync test page
â”‚
â”œâ”€â”€ catalog/                      # Catalog module
â”‚   â”œâ”€â”€ products.tsx              # Product list
â”‚   â””â”€â”€ add-product.tsx           # Add product
â”‚
â”œâ”€â”€ inventory/                    # Inventory module
â”‚   â”œâ”€â”€ stocks.tsx                # Stock list
â”‚   â””â”€â”€ stock-alerts.tsx          # Stock alerts
â”‚
â”œâ”€â”€ sale/                         # Sales module
â”‚   â”œâ”€â”€ customers.tsx             # Customer list
â”‚   â”œâ”€â”€ customer-groups.tsx       # Customer groups
â”‚   â”œâ”€â”€ sales-history.tsx         # Sales history
â”‚   â”œâ”€â”€ sales-return.tsx          # Sales return
â”‚   â”œâ”€â”€ payments-history.tsx      # Payment history
â”‚   â”œâ”€â”€ fulfillments.tsx          # Fulfillment
â”‚   â”œâ”€â”€ parked-orders.tsx         # Parked orders
â”‚   â”œâ”€â”€ add-quick-order.tsx       # Quick order
â”‚   â”œâ”€â”€ reports.tsx               # Report entry
â”‚   â”œâ”€â”€ reports-sales.tsx         # Sales reports
â”‚   â”œâ”€â”€ reports-financial.tsx     # Financial reports
â”‚   â”œâ”€â”€ reports-inventory.tsx     # Inventory reports
â”‚   â”œâ”€â”€ reports-legal.tsx         # Legal reports
â”‚   â”œâ”€â”€ reports-mas.tsx           # MAS reports
â”‚   â”œâ”€â”€ reports-purchase.tsx      # Purchase reports
â”‚   â””â”€â”€ reports/                  # 50+ report pages
â”‚       â”œâ”€â”€ customer-velocity.tsx
â”‚       â”œâ”€â”€ item-velocity.tsx
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ order/                        # Order flow
â”‚   â”œâ”€â”€ _layout.tsx               # Order layout
â”‚   â”œâ”€â”€ add-products.tsx          # Add products
â”‚   â”œâ”€â”€ add-customer.tsx          # Select customer
â”‚   â””â”€â”€ checkout.tsx              # Checkout
â”‚
â””â”€â”€ report/                       # Report module
    â”œâ”€â”€ index.tsx                 # Report list
    â””â”€â”€ ...

components/                       # Shared Components
â”œâ”€â”€ DataTable.tsx                 # Generic table
â”œâ”€â”€ PageHeader.tsx                # Page header
â”œâ”€â”€ Sidebar.tsx                   # Sidebar nav
â”œâ”€â”€ Header.tsx                    # Top header
â”œâ”€â”€ ProductSearch.tsx             # Product search
â”œâ”€â”€ CustomerCard.tsx              # Customer card
â”œâ”€â”€ OrderSummary.tsx              # Order summary
â”œâ”€â”€ NewCustomerModal.tsx          # Add customer
â”œâ”€â”€ SearchProductModal.tsx        # Search product
â””â”€â”€ ...

contexts/                         # React Contexts
â”œâ”€â”€ AuthContext.tsx               # Authentication
â”œâ”€â”€ OrderContext.tsx              # Shopping cart
â”œâ”€â”€ ClockContext.tsx              # Time tracking
â””â”€â”€ ParkedOrderContext.tsx        # Draft orders

utils/                            # Utilities
â”œâ”€â”€ api/                          # API clients
â”‚   â”œâ”€â”€ khub.ts                   # KHUB API client
â”‚   â”œâ”€â”€ auth.ts                   # Auth functions
â”‚   â””â”€â”€ index.ts
â””â”€â”€ powersync/                    # PowerSync
    â”œâ”€â”€ PowerSyncProvider.tsx     # Provider
    â”œâ”€â”€ KhubConnector.ts          # Upload logic
    â”œâ”€â”€ schema.ts                 # Local schema
    â”œâ”€â”€ useSyncStream.ts          # Base hook
    â””â”€â”€ hooks/                    # Data hooks
        â”œâ”€â”€ useProducts.ts
        â”œâ”€â”€ useCustomers.ts
        â”œâ”€â”€ useSaleOrders.ts
        â”œâ”€â”€ useStocks.ts
        â””â”€â”€ ...
```

---

## æ•°æ®æµå›¾

### Read Operation (æŸ¥è¯¢æ“ä½œ)

#### Web Application
```
Component â†’ Redux Selector â†’ HTTP GET â†’ Backend API â†’ PostgreSQL
  â†“ (Loading)                                            â†“ (Query)
  â†“                                                      â†“
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â† JSON Response â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
       Redux Store
            â†“
       Component Re-render
```

#### React Native APP
```
Component â†’ PowerSync Hook â†’ SQLite Query
  â†“ (Instant!)                â†“ (Local)
  â†“                           â†“
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â† Result â†â”€â”€â”€â”€â”€â”€â”˜
            â†“
       Component Render
       
(Background sync happens automatically)
```

### Write Operation (å†™å…¥æ“ä½œ)

#### Web Application
```
Form Submit â†’ Validation â†’ Redux Action â†’ Saga
                                           â†“
                                      HTTP POST/PUT
                                           â†“
                                      Backend API
                                           â†“
                                      PostgreSQL
                                           â†“
                                      Response
                                           â†“
                                      Redux Store
                                           â†“
                                      UI Update
```

#### React Native APP
```
Form Submit â†’ Validation â†’ Write to Local SQLite (Instant UI Update!)
                                   â†“
                              Queue CRUD Operation
                                   â†“
                          (Background, when online)
                                   â†“
                              PowerSync Upload
                                   â†“
                              HTTP PUT/PATCH
                                   â†“
                              Backend API
                                   â†“
                              PostgreSQL
                                   â†“
                              WAL Event
                                   â†“
                              PowerSync
                                   â†“
                          WebSocket Push to All Clients
                                   â†“
                          Local SQLite Merge
                                   â†“
                          UI Auto Refresh
```

---

## å®‰å…¨æž¶æž„

### Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Authentication Flow                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  1. User Login                                                â”‚
â”‚     â”œâ”€ Username/Email                                         â”‚
â”‚     â”œâ”€ Password or PIN                                        â”‚
â”‚     â””â”€ Optional: OTP (2FA)                                    â”‚
â”‚                                                               â”‚
â”‚  2. Backend Validation                                        â”‚
â”‚     â”œâ”€ Check credentials against database                     â”‚
â”‚     â”œâ”€ Verify OTP if enabled                                 â”‚
â”‚     â””â”€ Check user status (active/inactive)                    â”‚
â”‚                                                               â”‚
â”‚  3. Token Generation                                          â”‚
â”‚     â”œâ”€ Access Token (JWT)                                     â”‚
â”‚     â”‚  â”œâ”€ Algorithm: HS256                                    â”‚
â”‚     â”‚  â”œâ”€ Expiry: 1 day                                       â”‚
â”‚     â”‚  â”œâ”€ Payload:                                            â”‚
â”‚     â”‚  â”‚  â”œâ”€ user_id                                          â”‚
â”‚     â”‚  â”‚  â”œâ”€ tenant_id                                        â”‚
â”‚     â”‚  â”‚  â”œâ”€ permissions                                      â”‚
â”‚     â”‚  â”‚  â””â”€ audience: ["powersync"] (for APP)                â”‚
â”‚     â”‚  â””â”€ Secret: JWT_SECRET_KEY                              â”‚
â”‚     â”‚                                                          â”‚
â”‚     â””â”€ Refresh Token (JWT)                                    â”‚
â”‚        â”œâ”€ Expiry: 30 days                                     â”‚
â”‚        â””â”€ Used to get new access token                        â”‚
â”‚                                                               â”‚
â”‚  4. Token Storage                                             â”‚
â”‚     â”œâ”€ Web: LocalStorage or Cookie                            â”‚
â”‚     â””â”€ APP: AsyncStorage (encrypted)                          â”‚
â”‚                                                               â”‚
â”‚  5. Request Authorization                                     â”‚
â”‚     â”œâ”€ Header: Authorization: Bearer <token>                  â”‚
â”‚     â”œâ”€ Backend validates token on each request                â”‚
â”‚     â””â”€ PowerSync validates token for WebSocket                â”‚
â”‚                                                               â”‚
â”‚  6. Token Refresh                                             â”‚
â”‚     â”œâ”€ When access token expires                              â”‚
â”‚     â”œâ”€ Use refresh token to get new access token              â”‚
â”‚     â””â”€ Endpoint: /api/v1/core/user/authenticate/refresh       â”‚
â”‚                                                               â”‚
â”‚  7. Logout                                                    â”‚
â”‚     â”œâ”€ Clear tokens from storage                              â”‚
â”‚     â”œâ”€ (Optional) Revoke tokens on backend                    â”‚
â”‚     â””â”€ Close PowerSync connection                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Role-Based Access Control (RBAC)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RBAC Architecture                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Roles:                                                       â”‚
â”‚  â”œâ”€ Master Admin (master_admin = true)                        â”‚
â”‚  â”‚  â””â”€ Full access to all features                           â”‚
â”‚  â”œâ”€ Manager                                                   â”‚
â”‚  â”‚  â”œâ”€ Can manage products, customers, orders                â”‚
â”‚  â”‚  â”œâ”€ Can view reports                                      â”‚
â”‚  â”‚  â””â”€ Cannot manage users or settings                       â”‚
â”‚  â”œâ”€ Cashier                                                   â”‚
â”‚  â”‚  â”œâ”€ Can create orders (POS)                               â”‚
â”‚  â”‚  â”œâ”€ Can view products, customers                          â”‚
â”‚  â”‚  â””â”€ Cannot edit prices or view reports                    â”‚
â”‚  â””â”€ Supervisor                                                â”‚
â”‚     â”œâ”€ Can approve returns                                   â”‚
â”‚     â”œâ”€ Can override prices                                   â”‚
â”‚     â””â”€ Can view daily reports                                â”‚
â”‚                                                               â”‚
â”‚  Permissions:                                                 â”‚
â”‚  â”œâ”€ Permission Groups (e.g., AddProduct, ViewCustomer)        â”‚
â”‚  â”œâ”€ Each group contains multiple permissions                  â”‚
â”‚  â””â”€ Stored in JWT token payload                              â”‚
â”‚                                                               â”‚
â”‚  Frontend Check:                                              â”‚
â”‚  Web:                                                         â”‚
â”‚    <AuthorizeContentRoute                                    â”‚
â”‚      permissions={[Permission.ProductView]}                  â”‚
â”‚      path="/catalog/products"                                â”‚
â”‚      component={ProductsPage}                                â”‚
â”‚    />                                                         â”‚
â”‚                                                               â”‚
â”‚  APP:                                                         â”‚
â”‚    const { user } = useAuth();                               â”‚
â”‚    if (!user.permissions.includes('ProductView')) {          â”‚
â”‚      return <Unauthorized />;                                â”‚
â”‚    }                                                          â”‚
â”‚                                                               â”‚
â”‚  Backend Check:                                               â”‚
â”‚    @require_permissions('product:view')                      â”‚
â”‚    def get_products():                                       â”‚
â”‚        # Handler logic                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ€§èƒ½ä¼˜åŒ–

### Web Application

- **ä»£ç åˆ†å‰²**: React.lazy() + Suspense
- **åˆ†é¡µåŠ è½½**: æ¯é¡µ 20 æ¡è®°å½•
- **Redux Persist**: æŒä¹…åŒ– Redux Store
- **API ç¼“å­˜**: Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
- **CDN**: é™æ€èµ„æº CDN åŠ é€Ÿ

### React Native APP

- **ç¦»çº¿ä¼˜å…ˆ**: æœ¬åœ° SQLiteï¼Œå³æ—¶å“åº”
- **è™šæ‹Ÿæ»šåŠ¨**: FlatList è™šæ‹ŸåŒ–é•¿åˆ—è¡¨
- **å¢žé‡åŒæ­¥**: PowerSync åªåŒæ­¥å˜æ›´
- **åŽå°åŒæ­¥**: ä¸é˜»å¡ž UI çº¿ç¨‹
- **æ‰“å°é˜Ÿåˆ—**: é˜²æ­¢æ‰“å°å¡é¡¿

---

**æ–‡æ¡£ç»´æŠ¤**: AI Assistant  
**æœ€åŽæ›´æ–°**: 2024-02-05
