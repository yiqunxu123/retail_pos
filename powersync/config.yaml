# yaml-language-server: $schema=https://unpkg.com/@powersync/service-schema@latest/json-schema/powersync-config.json
# PowerSync Self-Hosted Configuration - Connected to KHUB PostgreSQL

# Replication source database (KHUB PostgreSQL)
replication:
  connections:
    - type: postgresql
      hostname: !env PS_KHUB_DB_HOST
      port: !env PS_KHUB_DB_PORT
      database: !env PS_KHUB_DB_NAME
      username: !env PS_KHUB_DB_USER
      password: !env PS_KHUB_DB_PASSWORD
      sslmode: disable

# Storage for sync buckets (MongoDB)
storage:
  type: mongodb
  uri: mongodb://mongo:27017/powersync?replicaSet=rs0

# API configuration
api:
  port: 8080

# Client authentication - KHUB JWT (HS256)
client_auth:
  audience: ["powersync"]
  jwks:
    keys:
      - kty: oct
        k: !env PS_JWT_SECRET_BASE64
        alg: HS256

# Sync Rules
sync_rules:
  path: /config/sync_rules.yaml
